{% load static i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>{% trans "Your Spotify Wrapped" %}</title>
   <!-- Link to the CSS file -->
   <link rel="stylesheet" href="{% static 'css/styles.css' %}">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
</head>

<!-- If 'is_mine' is true, show the choose_time link -->
{% if is_mine %}
    <a href="{% url 'choose_wrap_time' %}" class="escape-wrapped"> X </a>
{% endif %}

<a href="{% url 'profile' %}" class="profile-icon" aria-label="{% trans 'View Profile' %}">
    <i class="bi bi-person"></i>
</a>

{% if step == 1 %}
    <body class="transition-page",id="transition-1">
        <h2>{% trans "TRANSITION ONE - WELCOME" %}</h2>
        <a href="{% url 'view_wraps' %}?step=2&time_range={{ time_range }}">
            <button class="next-button">{% trans "Next: Top Songs" %}</button>
        </a>
    </body>
{% elif step == 2 %}
    <body class="top-songs-page">
        <a href="{% url 'profile' %}" class="profile-icon" aria-label="{% trans 'View Profile' %}">
            <i class="bi bi-person"></i>
        </a>
        <div class="topSongsTitle">
            <h2 class="topSongs">{% trans "Top Songs" %}</h2>
        </div>
        <div class="chart_topSongs">
            {% for track in top_tracks %}
                <div class="pillar_topSongs rank-{{ forloop.counter }}">
                    <div class="song-box_topSongs">
                        {% if track.image_url %}
                            <img src="{{ track.image_url }}" alt="{{ track.name }}">
                        {% endif %}
                        <div class="song-title_topSongs">{{ track.name }}</div>
                        <div class="song-artist_topSongs">
                            {% for artist in track.artists %}
                                {{ artist }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="rank_topSongs">{{ forloop.counter }}</div>
                </div>
            {% endfor %}
        </div>
        <a href="{% url 'view_wraps' %}?step=3">
            <button class="next-button">{% trans "Next: Top Artists" %}</button>
        </a>
    </body>
{% elif step == 3 %}
    <body class="transition-page", id="transition-2">
        <h2>{% trans "TRANSITION TWO" %}</h2>
        <a href="{% url 'view_wraps' %}?step=4&time_range={{ time_range }}">
            <button class="next-button">{% trans "Next: Top Artists" %}</button>
        </a>
        <a href="{% url 'view_wraps' %}?step=2&time_range={{ time_range }}">
            <button class="back-button">{% trans "Back: Top Songs" %}</button>
        </a>
    </body>
{% elif step == 4 %}
    <body class="top-artist-page">
        <div class="topArtistsTitle">
            <h2 class="topArtists">{% trans "Top Artists" %}</h2>
        </div>
        <a href="{% url 'profile' %}" class="profile-icon" aria-label="{% trans 'View Profile' %}">
            <i class="bi bi-person"></i>
        </a>
        <div class="chart_topArtists">
            {% for artist in top_artists %}
                <div class="pillar_topArtists">
                    <div class="artist-box_topArtists">
                        {% if artist.image_url %}
                            <img src="{{ artist.image_url }}" alt="{{ artist.name }}">
                        {% endif %}
                        <div class="rank_topArtists">{{ forloop.counter }}</div>
                    </div>
                    <div class="artist-name_topArtists">{{ artist.name }}</div>
                </div>
            {% endfor %}
        </div>
        <a href="{% url 'view_wraps' %}?step=5">
            <button class="next-button">{% trans "Next: Top Albums" %}</button>
        </a>
        <a href="{% url 'view_wraps' %}?step=2&time_range={{ time_range }}">
            <button class="back-button">{% trans "Back: Top Songs" %}</button>
        </a>
    </body>
{% elif step == 6 %}
    <body class="top-genres-page">
        <h4 class="topGenresTitle">{% trans "Top Genres" %}</h4>
        <a href="{% url 'profile' %}" class="profile-icon" aria-label="{% trans 'View Profile' %}">
            <i class="bi bi-person"></i>
        </a>
        <div class="genre-container">
            {% for genre, count in top_genres %}
                <div class="genre-box">
                    <div class="genre-rank">{{ forloop.counter }}</div>
                    <div class="genre-info">
                        <div class="genre-name">{{ genre }}</div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <p>{% trans "Time Range" %}: {{ time_range }}</p>

        <!-- Show 'Save to Profile' button only if 'is_mine' is true -->
        {% if is_mine %}
            <form method="post" action="{% url 'view_wraps' %}?time_range={{ time_range }}">
                {% csrf_token %}
                <input type="hidden" name="time_range" value="{{ time_range }}">
                <button class="next-button" type="submit" name="save">{% trans "Save to Profile" %}</button>
            </form>
        {% else %}
            <!-- Button to go back to friends' old wraps page -->
            <a href="{% url 'friends_page' %}">
                <button class="back-button">{% trans "Back to Friends' Wraps" %}</button>
            </a>
        {% endif %}
    </body>
{% endif %}
</html>
